{% extends 'base.html' %}

{% block title %}Manage Movies - Admin{% endblock %}

{% block content %}
<div class="mt-6">
  <h1 class="text-3xl font-bold mb-2">Manage Movies</h1>
  <p class="text-slate-600 mb-6">Add, edit, or remove movies from the database.</p>

  <!-- Add New Movie Form -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-12">
    <div class="bg-white border rounded p-6">
      <h2 class="text-xl font-semibold mb-4">Add New Movie</h2>
      
      <form method="POST" class="space-y-3">
        {% csrf_token %}
        <input type="hidden" name="action" value="create" />
        
        <div>
          <label class="block text-sm font-medium text-slate-700 mb-1">Title</label>
          <input type="text" name="title" class="w-full px-3 py-2 border rounded text-sm" required />
        </div>
        
        <div>
          <label class="block text-sm font-medium text-slate-700 mb-1">Slug (URL-friendly name)</label>
          <input type="text" name="slug" class="w-full px-3 py-2 border rounded text-sm" required />
        </div>
        
        <div>
          <label class="block text-sm font-medium text-slate-700 mb-1">Director</label>
          <input type="text" name="director" class="w-full px-3 py-2 border rounded text-sm" required />
        </div>
        
        <div>
          <label class="block text-sm font-medium text-slate-700 mb-1">Year</label>
          <input type="number" name="year" class="w-full px-3 py-2 border rounded text-sm" required />
        </div>
        
        <div>
          <label class="block text-sm font-medium text-slate-700 mb-1">Description</label>
          <textarea name="description" rows="3" class="w-full px-3 py-2 border rounded text-sm" required></textarea>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-slate-700 mb-1">Photo URL</label>
          <input type="url" name="photo_url" class="w-full px-3 py-2 border rounded text-sm" />
        </div>
        
        <button type="submit" class="w-full px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 font-medium">
          Add Movie
        </button>
      </form>
    </div>

    <div class="bg-blue-50 border border-blue-200 rounded p-6">
      <h3 class="font-semibold text-blue-900 mb-2">Tips</h3>
      <ul class="text-sm text-blue-900 space-y-2">
        <li>• <strong>Slug:</strong> Use lowercase letters and hyphens (e.g., "the-matrix")</li>
        <li>• <strong>Photo URL:</strong> Link to a movie poster image</li>
        <li>• <strong>Year:</strong> Release year (e.g., 1999)</li>
        <li>• All fields are required</li>
      </ul>
    </div>
  </div>

  <!-- Movies List -->
  <div>
    <h2 class="text-2xl font-semibold mb-4">Movies in Database</h2>
    
    {% if page_obj.paginator.count > 0 %}
      <div class="overflow-x-auto">
        <table class="w-full border-collapse">
          <thead>
            <tr class="bg-slate-100 border-b">
              <th class="px-4 py-2 text-left text-sm font-semibold">Title</th>
              <th class="px-4 py-2 text-left text-sm font-semibold">Slug</th>
              <th class="px-4 py-2 text-left text-sm font-semibold">Director</th>
              <th class="px-4 py-2 text-left text-sm font-semibold">Year</th>
              <th class="px-4 py-2 text-left text-sm font-semibold">Rating</th>
              <th class="px-4 py-2 text-center text-sm font-semibold">Action</th>
            </tr>
          </thead>
          <tbody>
            {% for movie in page_obj %}
              <tr class="border-b hover:bg-slate-50">
                <td class="px-4 py-3 text-sm">{{ movie.title }}</td>
                <td class="px-4 py-3 text-sm text-slate-600">{{ movie.slug }}</td>
                <td class="px-4 py-3 text-sm text-slate-600">{{ movie.director }}</td>
                <td class="px-4 py-3 text-sm">{{ movie.year }}</td>
                <td class="px-4 py-3 text-sm">⭐ {{ movie.avg_rating|default:"N/A" }}</td>
                <td class="px-4 py-3 text-center">
                  <form method="POST" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this movie?');">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="delete" />
                    <input type="hidden" name="slug" value="{{ movie.slug }}" />
                    <button type="submit" class="text-red-600 hover:text-red-800 text-sm font-medium">Delete</button>
                  </form>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      {% if page_obj.has_other_pages %}
        <div class="mt-6 flex justify-center gap-4">
          {% if page_obj.has_previous %}
            <a href="?page=1" class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300">First</a>
            <a href="?page={{ page_obj.previous_page_number }}" class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300">Previous</a>
          {% endif %}

          <span class="px-4 py-2 text-slate-700">
            Page <strong>{{ page_obj.number }}</strong> of <strong>{{ page_obj.paginator.num_pages }}</strong>
          </span>

          {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}" class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300">Next</a>
            <a href="?page={{ page_obj.paginator.num_pages }}" class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300">Last</a>
          {% endif %}
        </div>
      {% endif %}
    {% else %}
      <div class="bg-slate-50 border border-slate-200 rounded p-6 text-center">
        <p class="text-slate-700 mb-2">No movies found in the database.</p>
        <p class="text-slate-600 text-sm">Use the form above to add new movies.</p>
      </div>
    {% endif %}
  </div>
</div>

{% endblock %}
